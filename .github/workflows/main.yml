name: Deploy to FTP

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Deploy to FTP with curl
      env:
        FTP_SERVER: ${{ secrets.FTP_SERVER }}
        FTP_USERNAME: ${{ secrets.FTP_USERNAME }}
        FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}
      run: |
        # Crear funci√≥n para subir archivos recursivamente
        upload_files() {
          for file in $(find . -type f -not -path "./.git/*" -not -path "./.github/*" -not -name "*.md" -not -name "test_ftp.py" -not -name "*deploy*.txt"); do
            # Crear directorio en servidor si no existe
            dir=$(dirname "$file")
            if [ "$dir" != "." ]; then
              curl --ftp-create-dirs -T /dev/null "ftp://$FTP_USERNAME:$FTP_PASSWORD@$FTP_SERVER/$dir/" || true
            fi
            
            # Subir archivo
            echo "Subiendo: $file"
            curl --ftp-create-dirs -T "$file" "ftp://$FTP_USERNAME:$FTP_PASSWORD@$FTP_SERVER/$file"
          done
        }
        
        # Ejecutar upload
        upload_files