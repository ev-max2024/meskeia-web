name: ğŸ§ª Test FTP Deployment

on:
  push:
    paths:
      - 'test-ftp-deployment.txt'
  workflow_dispatch:

jobs:
  test-ftp:
    runs-on: ubuntu-latest
    name: Test FTP Connection
    
    steps:
    - name: ğŸ›ï¸ Checkout repository
      uses: actions/checkout@v4
      
    - name: ğŸ“ Show test file content
      run: |
        echo "=== Contenido del archivo de prueba ==="
        cat test-ftp-deployment.txt
        echo "=== Fin del archivo ==="
        
    - name: ğŸ”§ Install lftp
      run: |
        sudo apt-get update
        sudo apt-get install -y lftp
        
    - name: ğŸš€ Test FTP Upload with lftp
      run: |
        echo "=== Testing FTP connection with lftp ==="
        echo "Server: ${{ secrets.FTP_SERVER }}"
        echo "Username: ${{ secrets.FTP_USERNAME }}"
        echo "File to upload: test-ftp-deployment.txt"
        echo "Target: /public_html/meskeia.com/"
        echo ""
        
        lftp -c "set ftp:ssl-allow no; set ftp:passive-mode on; open -u '${{ secrets.FTP_USERNAME }}','${{ secrets.FTP_PASSWORD }}' ${{ secrets.FTP_SERVER }}; lcd ./; cd /public_html/meskeia.com/; put test-ftp-deployment.txt; ls -la test-ftp-deployment.txt; quit"
        
    - name: Fallback SFTP if FTP failed
      if: failure()
      run: |
        echo "=== FTP failed, trying alternative methods ==="
        echo "This step runs only if the previous FTP step failed"
        
    - name: âœ… Success notification
      run: |
        echo "ğŸ‰ Test FTP deployment completed!"
        echo "Check https://meskeia.com/test-ftp-deployment.txt to verify upload"